---
title: "Flight Price Analysis"
author: "Ayan Jhaveri"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = 'markup', message = FALSE, warning = FALSE)
```

## Data Preparation

### Loading and Cleaning Data

```{r echo=TRUE}
# Load necessary libraries
library(dplyr)

# Load the dataset
data <- read.csv("D:/1_BU/Fundamental of ML/Term Project/flight_data.csv")

colnames(data)[colnames(data) == "duration"] <- "flight_duration"
# Remove missing values
data <- na.omit(data)

# Remove outliers based on price
Q1 <- quantile(data$price, 0.25)
Q3 <- quantile(data$price, 0.75)
IQR_value <- Q3 - Q1
lower_bound <- Q1 - 1.5 * IQR_value
upper_bound <- Q3 + 1.5 * IQR_value
data <- subset(data, price >= lower_bound & price <= upper_bound)

# Drop unwanted columns
data <- data %>%
  select(-flight, -source_city, -destination_city)

```

## 1.Duration and Price Relation

### Scatter Plot and Correlation

This section explores the relationship between flight duration and price using a scatter plot and correlation analysis.

```{r echo=TRUE}
# Scatter plot of Price vs. Flight Duration
plot(data$flight_duration, data$price, 
     main = "Scatter Plot of Price vs. Flight Duration",
     xlab = "Flight Duration",
     ylab = "Price",
     col = "blue",
     pch = 16)

# Calculate correlation coefficient
cor_coefficient <- cor(data$flight_duration, data$price)

# Perform correlation test
cor_test_result <- cor.test(data$flight_duration, data$price)
print(cor_test_result)
```

### Linear Regression

```{r echo=TRUE}
# Linear regression model
linear_model <- lm(price ~ flight_duration, data = data)
intercept <- coef(linear_model)[1]
slope <- coef(linear_model)
print(paste("Equation of the line: Price =", round(intercept, 2), "+", round(slope, 2), " * Duration"))

# Checking assumptions
par(mfrow=c(1,2))
plot(fitted(linear_model), resid(linear_model), main="Residuals vs Fitted")
hist(resid(linear_model), main="Histogram of Residuals")
```

The p-value for duration is less than 0.05 , we can reject null hypothesis and infer that duration of the flight has a significant linear relationship with the price. As the duration of the flight increases, the price tends to increase by an average of 347.59 INR.

```{r echo=FALSE}
# Create a scatter plot with a regression line
library(ggplot2)
ggplot(data, aes(x = flight_duration, y = price)) +
  geom_point(color = "blue", alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(title = "Scatter Plot of Price vs. Flight Duration with Regression Line",
       x = "Flight Duration",
       y = "Price") +
  theme_minimal()
```

## 2.Stops vs. Price

```{r echo=TRUE}
# Boxplot of Stops vs Price
boxplot(price ~ stops, data = data, 
        main = "Boxplot of Stops vs. Price",
        xlab = "Stops",
        ylab = "Price",
        col = c("blue", "green", "coral"))
```

### ANOVA TEST

```{r echo=TRUE}
# Convert stops to factor and check if it's a factor
data$stops = as.factor(data$stops)

m = aov(data$price ~ data$stops, data = data)
summary(m)

# Pairwise t-test for Stops vs. Price
pairwise.t.test(data$price, data$stops, p.adjust = 'none')
```

With a 95% confidence level, we can infer significant differences in mean prices among flights with varying numbers of stops. So, the number of stops does influence the price of the flight.

### Mean Prices by Stops

```{r echo=FALSE}
# Calculate mean prices according to the number of stops
mean_prices_by_stops <- data %>%
  group_by(stops) %>%
  summarize(mean_price = mean(price, na.rm = TRUE))

# Display the calculated mean prices
print(mean_prices_by_stops)
```

### 3. Effect Of Airline and Days Left on Price

```{r echo=TRUE}
# Boxplot of Airline vs Price
boxplot(price ~ airline, data = data, 
        main = "Boxplot of Airline vs. Price",
        xlab = "Airline",
        ylab = "Price",
        col = c("blue", "green"))
```

```{r echo=TRUE}
# Convert airline to factor and check if it's a factor
data$airline = as.factor(data$airline)

# ANOVA test for Airline vs Price
m = aov(data$price ~ data$airline, data = data)
summary(m)

# ANCOVA (Airline and Days Left) test
library(car)
Anova(lm(data$price ~ data$airline + data$days_left), type = 3)
```

Airline has a significant impact on flight prices, and this effect persists even when considering the influence of 'days_left'. Both the choice of airline and the number of days left until departure contribute to the variability in flight prices.

## 4. Effect Of Departure and Arrival Time on Price

```{r echo=TRUE}
# Boxplot of Departure Time vs Price
boxplot(price ~ departure_time, data = data, 
        main = "Boxplot of Departure Time vs. Price",
        xlab = "Departure Time",
        ylab = "Price",
        col = c("blue", "green", "red", "lightblue", "lightgreen"))

```

```{r echo=TRUE}
library(car)
# Convert departure_time to factor
data$departure_time = as.factor(data$departure_time)
data$arrival_time = as.factor(data$arrival_time)

# Two-way ANOVA for Departure Time and Arrival Time vs Price

two_way_model = lm(price ~ departure_time + data$arrival_time , data = data)
Anova(two_way_model, type = 3)

# Interaction plot for Departure and Arrival Time
interaction.plot(data$arrival_time, data$departure_time, data$price)

# Stratifying data by arrival time and performing individual ANOVA
arrival_levels <- levels(data$arrival_time)

perform_anova_summary <- function(level) {
  subset_data <- subset(data, arrival_time == level)
  print(paste("Summary for ANOVA -", level))
  print(summary(aov(price ~ departure_time, data = subset_data)))
  print("----")
}

lapply(arrival_levels, perform_anova_summary)
```

Departure time alone has no effect on the price of the flight. If the departure time is "Early Morning" it does not matter what is the arrival time. In all other cases, the departure and arrival time combined affect the price of the flight.
